<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<input id="slider-x" type="range" min=".2" max="5" value="1" step=".1"  oninput="moveSlider(this)">
<input id="slider-y" type="range" min="-20" max="100" value="0"   oninput="moveSlider1(this)">
<button onclick="myFunction()">Delete</button>
<button onclick="myFunction1()">Circle</button>
<input type="file" accept='.svg' id="file-input" />

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 200" onload="makeDraggable(evt)">
  <rect width="300" height="300" fill="#eee"></rect>

</svg>


<script type="text/javascript">





//-----initialise variables--------------------------------
var SVG_TARGET_ELEMENT = "costy";
var costy=0;
var selectedElement = false;
var offset;
var svg,tmpx,tmpy;
var value =[],rot=[];


//read slider scale(1)
function moveSlider(slider) {

	var circle = document.getElementById(SVG_TARGET_ELEMENT);
      var tab=circle.getAttributeNS(null, 'id');
	value[tab] = slider.value;
     circle.setAttributeNS(null, "transform","translate("+tmpx+","+tmpy+") scale("+value[tab]+")");

	
}

function moveSlider1(slider) {

	var circle = document.getElementById(SVG_TARGET_ELEMENT);
      var tab=circle.getAttributeNS(null, 'id');
	value[tab] = slider.value;
     rot[tab] = slider.value;
     circle.setAttributeNS(null, "transform","translate("+tmpx+","+tmpy+") scale("+value[tab]+") rotate("+rot[tab]+")");

	
}

//########## when click "Circle" button >>> create new element
function myFunction1(){
costy++;
var element = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
svg.appendChild(element);
element.setAttributeNS(null, 'x', 0);
element.setAttributeNS(null, 'y', 0);
element.setAttributeNS(null, 'r', 30);
element.setAttributeNS(null, 'id', costy);
element.setAttributeNS(null, 'class', "draggable");
value[costy]=1;
rot[costy]=1;
}

function myFunction2(el){

doc = document.implementation.createHTMLDocument("test"); 
doc.write(el);
var resu = doc.getElementsByTagName("path")[0]; 
var bro=resu.getAttributeNS(null, 'd');
console.log(bro);

costy++;

var element = document.createElementNS('http://www.w3.org/2000/svg', 'path');
svg.appendChild(element);
element.setAttributeNS(null, 'x', 0);
element.setAttributeNS(null, 'y', 0);
element.setAttributeNS(null, 'id', costy);
element.setAttributeNS(null, 'class', "draggable");
element.setAttributeNS(null, 'd', bro);
element.setAttributeNS(null, 'fill', "black");
element.setAttributeNS(null, 'fill-rule', "evenodd");
element.setAttributeNS(null, 'stroke', "none");
value[costy]=1;
rot[costy]=1;
}


function makeDraggable(evt) {
  svg = evt.target;
  svg.addEventListener('mousedown', startDrag);
  svg.addEventListener('mousemove', drag);
  svg.addEventListener('mouseup', endDrag);
  svg.addEventListener('mouseleave', endDrag);
        svg.addEventListener('touchstart', startDrag);
        svg.addEventListener('touchmove', drag);
        svg.addEventListener('touchend', endDrag);
        svg.addEventListener('touchleave', endDrag);
        svg.addEventListener('touchcancel', endDrag);
     function startDrag(evt) {
       if (evt.target.classList.contains('draggable')) {
          selectedElement = evt.target;
          SVG_TARGET_ELEMENT=selectedElement.id;

    offset = getMousePosition(evt);
    offset.x -= parseFloat(selectedElement.getAttributeNS(null, "x"));
    offset.y -= parseFloat(selectedElement.getAttributeNS(null, "y"));

          }}
     function drag(evt) {
       if (selectedElement) {
          evt.preventDefault();
          var coord = getMousePosition(evt);

tmpx=coord.x-offset.x;
tmpy=coord.y-offset.y
    selectedElement.setAttributeNS(null, "x", tmpx);
    selectedElement.setAttributeNS(null, "y", tmpy);
    var tab=selectedElement.getAttributeNS(null, 'id');

console.log(value[tab]);

          selectedElement.setAttributeNS(null, "transform","translate("+tmpx+","+tmpy+") scale("+value[tab]+") rotate("+rot[tab]+")");


}}
  
    function endDrag(evt) {
       selectedElement = null;}
}
function getMousePosition(evt) {
  var CTM = svg.getScreenCTM();
 if (evt.touches) { evt = evt.touches[0]; }
  return {
    x: (evt.clientX - CTM.e) / CTM.a,
    y: (evt.clientY - CTM.f) / CTM.d
  };
}
function readSingleFile(e) {
  var file = e.target.files[0];
  if (!file) {
    return;
  }
  var reader = new FileReader();
  reader.onload = function(e) {
    var contents = e.target.result;
      myFunction2(contents);
    //alert(contents);
    //displayContents(contents);
  };
  reader.readAsText(file);
}

//quando event "change" 
document.getElementById('file-input')
  .addEventListener('change', readSingleFile, false);

//delete element
function myFunction(){
var element = document.getElementById(SVG_TARGET_ELEMENT);
svg.removeChild(element);
}
</script>
</body>
</html>